import{F,N as q,O as He,Q as be,R as P,S as b,T as O,W as L,U as C,V as ke}from"./index-CrXQ4ZbO.js";import{a,_ as h}from"./objectSpread2-t4yaKxP6.js";import{g as $}from"./index-D4sVUtYa.js";import{r as qe}from"./index.browser.esm-344Elki9.js";var ne={exports:{}},$e=Ie;function Ie(t,e){if(t&&e)return Ie(t)(e);if(typeof t!="function")throw new TypeError("need wrapper function");return Object.keys(t).forEach(function(n){i[n]=t[n]}),i;function i(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];var s=t.apply(this,n),o=n[n.length-1];return typeof s=="function"&&s!==o&&Object.keys(o).forEach(function(c){s[c]=o[c]}),s}}var Ae=$e;ne.exports=Ae(M);ne.exports.strict=Ae(Oe);M.proto=M(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return M(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return Oe(this)},configurable:!0})});function M(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function Oe(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},i=t.name||"Function wrapped with `once`";return e.onceError=i+" shouldn't be called more than once",e.called=!1,e}var re=ne.exports;const Ge=$(re);var ze=re,Ve=function(){},Be=function(t){return t.setHeader&&typeof t.abort=="function"},Je=function(t){return t.stdio&&Array.isArray(t.stdio)&&t.stdio.length===3},Ce=function(t,e,i){if(typeof e=="function")return Ce(t,null,e);e||(e={}),i=ze(i||Ve);var n=t._writableState,r=t._readableState,s=e.readable||e.readable!==!1&&t.readable,o=e.writable||e.writable!==!1&&t.writable,c=!1,d=function(){t.writable||l()},l=function(){o=!1,s||i.call(t)},f=function(){s=!1,o||i.call(t)},m=function(I){i.call(t,I?new Error("exited with error code: "+I):null)},p=function(I){i.call(t,I)},w=function(){process.nextTick(g)},g=function(){if(!c){if(s&&!(r&&r.ended&&!r.destroyed))return i.call(t,new Error("premature close"));if(o&&!(n&&n.ended&&!n.destroyed))return i.call(t,new Error("premature close"))}},S=function(){t.req.on("finish",l)};return Be(t)?(t.on("complete",l),t.on("abort",w),t.req?S():t.on("request",S)):o&&!n&&(t.on("end",d),t.on("close",d)),Je(t)&&t.on("exit",m),t.on("end",f),t.on("finish",l),e.error!==!1&&t.on("error",p),t.on("close",w),function(){c=!0,t.removeListener("complete",l),t.removeListener("abort",w),t.removeListener("request",S),t.req&&t.req.removeListener("finish",l),t.removeListener("end",d),t.removeListener("close",d),t.removeListener("finish",l),t.removeListener("exit",m),t.removeListener("end",f),t.removeListener("error",p),t.removeListener("close",w)}},Te=Ce;const ae=$(Te);var Ke=re,Ye=Te,x;try{x=qe}catch{}var W=function(){},Qe=/^v?\.0/.test(process.version),G=function(t){return typeof t=="function"},Ze=function(t){return!Qe||!x?!1:(t instanceof(x.ReadStream||W)||t instanceof(x.WriteStream||W))&&G(t.close)},Xe=function(t){return t.setHeader&&G(t.abort)},et=function(t,e,i,n){n=Ke(n);var r=!1;t.on("close",function(){r=!0}),Ye(t,{readable:e,writable:i},function(o){if(o)return n(o);r=!0,n()});var s=!1;return function(o){if(!r&&!s){if(s=!0,Ze(t))return t.close(W);if(Xe(t))return t.abort();if(G(t.destroy))return t.destroy();n(o||new Error("stream was destroyed"))}}},ce=function(t){t()},tt=function(t,e){return t.pipe(e)},it=function(){var t=Array.prototype.slice.call(arguments),e=G(t[t.length-1]||W)&&t.pop()||W;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Error("pump requires two streams per minimum");var i,n=t.map(function(r,s){var o=s<t.length-1,c=s>0;return et(r,o,c,function(d){i||(i=d),d&&n.forEach(ce),!o&&(n.forEach(ce),e(i))})});return t.reduce(tt)},nt=it;const de=$(nt),Z=F.getLogger("auth");Z.setLevel("error");const J={light:"light",dark:"dark"};function U(){}const le="SYN",K="ACK",ue="BRK";class he extends q.Duplex{constructor({name:e,target:i,targetWindow:n=window,targetOrigin:r="*"}){if(super({objectMode:!0}),a(this,"_init",void 0),a(this,"_haveSyn",void 0),a(this,"_name",void 0),a(this,"_target",void 0),a(this,"_targetWindow",void 0),a(this,"_targetOrigin",void 0),a(this,"_onMessage",void 0),a(this,"_synIntervalId",void 0),!e||!i)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=e,this._target=i,this._targetWindow=n,this._targetOrigin=r,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(ue,null,U),this._haveSyn=!1,this._init=!1}_handShake(){this._write(le,null,U),this.cork()}_onData(e){if(!this._init)e===le?(this._haveSyn=!0,this._write(K,null,U)):e===K&&(this._init=!0,this._haveSyn||this._write(K,null,U),this.uncork());else if(e===ue)this._break();else try{this.push(e)}catch(i){this.emit("error",i)}}_postMessage(e){const i=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},i)}onMessage(e){const i=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof i!="object"||i.target!==this._name||!i.data||this._onData(i.data)}_read(){}_write(e,i,n){this._postMessage(e),n()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}function fe(t,e,i){try{Reflect.apply(t,e,i)}catch(n){setTimeout(()=>{throw n})}}function rt(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=t[n];return i}class z extends He.EventEmitter{emit(e,...i){let n=e==="error";const r=this._events;if(r!==void 0)n=n&&r.error===void 0;else if(!n)return!1;if(n){let o;if(i.length>0&&([o]=i),o instanceof Error)throw o;const c=new Error(`Unhandled error.${o?` (${o.message})`:""}`);throw c.context=o,c}const s=r[e];if(s===void 0)return!1;if(typeof s=="function")fe(s,this,i);else{const o=s.length,c=rt(s);for(let d=0;d<o;d+=1)fe(c[d],this,i)}return!0}}class R extends Error{constructor({code:e,message:i,data:n}){if(!Number.isInteger(e))throw new Error("code must be an integer");if(!i||typeof i!="string")throw new Error("message must be string");super(i),a(this,"code",void 0),a(this,"data",void 0),this.code=e,n!==void 0&&(this.data=n)}toString(){return be({code:this.code,message:this.message,data:this.data,stack:this.stack})}}class st extends q.Duplex{constructor({parent:e,name:i}){super({objectMode:!0}),a(this,"_parent",void 0),a(this,"_name",void 0),this._parent=e,this._name=i}_read(){}_write(e,i,n){this._parent.push({name:this._name,data:e}),n()}}const y={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603}},me={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};var Ne=function(t,e){if(typeof t>"u"||t===null)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)};const pe=y.rpc.internal,ot="Unspecified error message. This is a bug, please report it.",at="Unspecified server error.";function Re(t){return Number.isInteger(t)}function we(t){return typeof t=="string"&&t.length>0}function H(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function ct(t){if(typeof t!="object"||t===null)return!1;try{let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}catch{return!1}}function dt(t){return t>=-32099&&t<=-32e3}function Pe(t){const e=t;return!(!e||!Re(e.code)||!we(e.message)||e.stack&&!we(e.stack))}function se(t,e=ot){if(Re(t)){const i=t.toString();if(Ne(me,i))return me[i].message;if(dt(t))return at}return e}const lt={code:pe,message:se(pe)};function X(t){try{JSON.parse(JSON.stringify(t,(e,i)=>{if(e==="__proto__"||e==="constructor")throw new Error("Not valid json");if(typeof i=="function"||typeof i=="symbol")throw new Error("Not valid json");return i}),(e,i)=>{if(!(e==="__proto__"||e==="constructor"))return i})}catch{return!1}return!0}function ge(t){return Object.getOwnPropertyNames(t).reduce((e,i)=>{const n=t[i];return X(n)&&(e[i]=n),e},{})}function Le(t){return Array.isArray(t)?t.map(e=>X(e)?e:H(e)?ge(e):null):H(t)?ge(t):X(t)?t:null}function ut(t,e){if(t&&typeof t=="object"&&"serialize"in t&&typeof t.serialize=="function")return t.serialize();if(Pe(t))return t;const i=Le(t);return h(h({},e),{},{data:{cause:i}})}function _e(t,{fallbackError:e=lt,shouldIncludeStack:i=!0}={}){if(!Pe(e))throw new Error("Must provide fallback error with integer number code and string message.");const n=ut(t,e);return i||delete n.stack,n}function ht(t){return H(t)&&Ne(t,"cause")&&H(t.cause)}var ft=function(t,e){if(typeof t>"u"||t===null)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)};function mt(t){return Number.isInteger(t)&&t>=1e3&&t<=4999}function pt(t,e){if(e!=="[Circular]")return e}class We extends Error{constructor(e,i,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!i||typeof i!="string")throw new Error('"message" must be a non-empty string.');ht(n)?(super(i,{cause:n.cause}),a(this,"cause",void 0),a(this,"code",void 0),a(this,"data",void 0),ft(this,"cause")||Object.assign(this,{cause:n.cause})):(super(i),a(this,"cause",void 0),a(this,"code",void 0),a(this,"data",void 0)),n!==void 0&&(this.data=n),this.code=e,this.cause=n==null?void 0:n.cause}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data,ct(this.data)&&(e.data.cause=Le(this.data.cause))),this.stack&&(e.stack=this.stack),e}toString(){return be(this.serialize(),{replacer:pt,space:2})}}class k extends We{constructor(e,i,n){if(!mt(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,i,n)}}function wt(t){if(t){if(typeof t=="string")return[t];if(typeof t=="object"&&!Array.isArray(t)){const{message:e,data:i}=t;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e??void 0,i]}}return[]}function v(t,e){const[i,n]=wt(e);return new We(t,i??se(t),n)}const j={parse:t=>v(y.rpc.parse,t),invalidRequest:t=>v(y.rpc.invalidRequest,t),invalidParams:t=>v(y.rpc.invalidParams,t),methodNotFound:t=>v(y.rpc.methodNotFound,t),internal:t=>v(y.rpc.internal,t),server:t=>{if(!t||typeof t!="object"||Array.isArray(t))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=t;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return v(e,t)},invalidInput:t=>v(y.rpc.invalidInput,t),resourceNotFound:t=>v(y.rpc.resourceNotFound,t),resourceUnavailable:t=>v(y.rpc.resourceUnavailable,t),transactionRejected:t=>v(y.rpc.transactionRejected,t),methodNotSupported:t=>v(y.rpc.methodNotSupported,t),limitExceeded:t=>v(y.rpc.limitExceeded,t)},ee=(t,e,i=!0)=>(n,r)=>{n||r.error?e(n||r.error):!i||Array.isArray(r)?t(r):t(r.result)};function gt(){const t={};function e(){return!1}const i=new z;function n(d){const l=t[d.id];if(!l)throw new Error(`StreamMiddleware - Unknown response id "${d.id}"`);delete t[d.id],Object.assign(l.res,d),setTimeout(l.end)}function r(d){i.emit("notification",d)}function s(d,l,f){let m;try{!d.id?r(d):n(d)}catch(p){m=p}f(m)}const o=new q.Duplex({objectMode:!0,read:e,write:s});return{events:i,middleware:(d,l,f,m)=>{o.push(d),t[d.id]={req:d,res:l,next:f,end:m}},stream:o}}function _t(){return(t,e,i,n)=>{const r=t.id,s=Math.random().toString(36).slice(2);t.id=s,e.id=s,i(o=>{t.id=r,e.id=r,o()})}}function ve(t){const{message:e="",code:i=-32603,stack:n="Stack trace is not available.",data:r=""}=t,s=parseInt((i==null?void 0:i.toString())||"-32603");return{message:e||(t==null?void 0:t.toString())||se(s),code:s,stack:n,data:r||e||(t==null?void 0:t.toString())}}class A extends z{constructor(){super(),a(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,i,n){const r=[];let s=null,o=!1;for(const c of n)if([s,o]=await A._runMiddleware(e,i,c,r),o)break;return[s,o,r.reverse()]}static _runMiddleware(e,i,n,r){return new Promise(s=>{const o=d=>{const l=d||i.error;l&&(typeof l=="object"&&Object.keys(l).includes("stack")===!1&&(l.stack="Stack trace is not available."),Z.error(l),i.error=_e(l,{shouldIncludeStack:!0,fallbackError:ve(l)})),s([l,!0])},c=d=>{i.error?o(i.error):(d&&(typeof d!="function"&&o(new R({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),r.push(d)),s([null,!1]))};try{n(e,i,c,o)}catch(d){o(d)}})}static async _runReturnHandlers(e){for(const i of e)await new Promise((n,r)=>{i(s=>s?r(s):n())})}static _checkForCompletion(e,i,n){if(!("result"in i)&&!("error"in i))throw new R({code:-32603,message:"Response has no error or result for request"});if(!n)throw new R({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,i){if(i&&typeof i!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?i?this._handleBatch(e,i):this._handleBatch(e):i?this._handle(e,i):this._promiseHandle(e)}asMiddleware(){return async(e,i,n,r)=>{try{const[s,o,c]=await A._runAllMiddleware(e,i,this._middleware);return o?(await A._runReturnHandlers(c),r(s)):n(async d=>{try{await A._runReturnHandlers(c)}catch(l){return d(l)}return d()})}catch(s){return r(s)}}}async _handleBatch(e,i){try{const n=await Promise.all(e.map(this._promiseHandle.bind(this)));return i?i(null,n):n}catch(n){if(i)return i(n);throw n}}_promiseHandle(e){return new Promise((i,n)=>{this._handle(e,(r,s)=>{r&&s===void 0?n(r):i(s)}).catch(n)})}async _handle(e,i){if(!e||Array.isArray(e)||typeof e!="object"){const o=new R({code:-32603,message:"request must be plain object"});return i(o,{id:void 0,jsonrpc:"2.0",error:o})}if(typeof e.method!="string"){const o=new R({code:-32603,message:"method must be string"});return i(o,{id:e.id,jsonrpc:"2.0",error:o})}const n=h({},e),r={id:n.id,jsonrpc:n.jsonrpc};let s=null;try{await this._processRequest(n,r)}catch(o){s=o}return s&&(delete r.result,r.error||(typeof s=="object"&&Object.keys(s).includes("stack")===!1&&(s.stack="Stack trace is not available."),Z.error(s),r.error=_e(s,{shouldIncludeStack:!0,fallbackError:ve(s)}))),i(s,r)}async _processRequest(e,i){const[n,r,s]=await A._runAllMiddleware(e,i,this._middleware);if(A._checkForCompletion(e,i,r),await A._runReturnHandlers(s),n)throw n}}const ye=Symbol("IGNORE_SUBSTREAM");class vt extends q.Duplex{constructor(e={}){super(h(h({},e),{},{objectMode:!0})),a(this,"_substreams",void 0),a(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const i=new st({parent:this,name:e});return this._substreams[e]=i,yt(this,n=>i.destroy(n||void 0)),i}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=ye}_read(){}_write(e,i,n){const{name:r,data:s}=e;if(!r)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),n();const o=this._substreams[r];return o?(o!==ye&&o.push(s),n()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${r}"`),n())}}function yt(t,e){const i=Ge(e);ae(t,{readable:!1},i),ae(t,{writable:!1},i)}const Et={height:660,width:375},St={height:700,width:1200},bt={height:700,width:450},It="setup_complete",T={IFRAME_STATUS:"iframe_status",CLOSE_WINDOW:"close_window",USER_LOGGED_IN:"user_logged_in",USER_LOGGED_OUT:"user_logged_out",TOGGLE_WIDGET_BUTTON:"toggle_widget_button",ALLOW_WALLET_SERVICE:"allow_wallet_service"},E={LOGOUT:"logout",WALLET_INSTANCE_ID:"wallet_instance_id",USER_INFO:"user_info",SET_PROVIDER:"set_provider",TOPUP:"topup",IFRAME_STATUS:"iframe_status",CLOSED_WINDOW:"closed_window",WINDOW_BLOCKED:"window_blocked",GET_PROVIDER_STATE:"get_provider_state",LOGIN_WITH_PRIVATE_KEY:"login_with_private_key",SHOW_WALLET_CONNECT:"show_wallet_connect",SHOW_CHECKOUT:"show_checkout",SHOW_WALLET_UI:"show_wallet_ui",SHOW_SWAP:"show_swap",LOGIN_WITH_SESSION_ID:"login_with_session_id"},De={GET_PROVIDER_STATE:"wallet_get_provider_state",WALLET_SWITCH_CHAIN:"wallet_switchChain"},Y={ACCOUNTS_CHANGED:"wallet_accounts_changed",CHAIN_CHANGED:"wallet_chain_changed",UNLOCK_STATE_CHANGED:"wallet_unlock_state_changed"},Q=()=>Math.random().toString(36).slice(2);function te({width:t,height:e}){const i=window.screenLeft!==void 0?window.screenLeft:window.screenX,n=window.screenTop!==void 0?window.screenTop:window.screenY,r=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,o=1,c=Math.abs((r-t)/2/o+i),d=Math.abs((s-e)/2/o+n);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${e/o},width=${t/o},top=${d},left=${c}`}function At(t){return function(i,n,r){r(s=>{n.error&&F.warn(`Error in RPC response:
`,n),!i.isTorusInternal&&(F.info(`RPC (${t.origin}):`,i,"->",n),s())})}}function Ue(t){return t!==null&&typeof t=="object"&&typeof t.pipe=="function"}function Ot(t){return Ue(t)&&t.writable!==!1&&typeof t._write=="function"&&typeof t._writableState=="object"}function Ct(t){return Ue(t)&&t.readable!==!1&&typeof t._read=="function"&&typeof t._readableState=="object"}function Tt(t){return Ot(t)&&Ct(t)}var _={errors:{disconnected:()=>"Web3Auth: Lost connection to Web3Auth.",permanentlyDisconnected:()=>"Web3Auth: Disconnected from iframe. Page reload required.",unsupportedSync:t=>`Web3Auth: The Web3Auth Ethereum provider does not support synchronous methods like ${t} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:t=>`Invalid options. Received: { maxEventListeners: ${t}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:t=>`'args.logger' must include required method '${t}'.`},info:{connected:t=>`Web3Auth: Connected to chain with ID "${t}".`}},u=F.getLogger("ws-embed");function Nt(){return(t,e,i)=>{(typeof t.method!="string"||!t.method)&&(e.error=j.invalidRequest({message:"The request 'method' must be a non-empty string.",data:h(h({},t||{}),{},{cause:"The request 'method' must be a non-empty string."})})),i(n=>{const{error:r}=e;return r&&u.error(`Ws-Embed - RPC Error: ${r.message}`,r),n()})}}function Rt(t,e,i){let n=`Web3Auth: Lost connection to "${t}".`;e!=null&&e.stack&&(n+=`
${e.stack}`),u.warn(n),i&&i.listenerCount("error")>0&&i.emit("error",n)}const Pt=["eth_subscription"];class Me extends z{constructor(e,{maxEventListeners:i=100,jsonRpcStreamName:n="provider"}){if(super(),a(this,"rpcEngine",void 0),a(this,"jsonRpcConnectionEvents",void 0),a(this,"isWeb3Auth",void 0),a(this,"state",void 0),!Tt(e))throw new Error(_.errors.invalidDuplexStream());this.isWeb3Auth=!0,this.setMaxListeners(i),this.handleConnect=this.handleConnect.bind(this),this.handleDisconnect=this.handleDisconnect.bind(this),this.handleStreamDisconnect=this.handleStreamDisconnect.bind(this),this.rpcRequest=this.rpcRequest.bind(this),this.initializeState=this.initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this),this.send=this.send.bind(this);const r=new vt;de(e,r,e,this.handleStreamDisconnect.bind(this,"Web3Auth")),r.ignoreStream("phishing");const s=gt();de(s.stream,r.createStream(n),s.stream,this.handleStreamDisconnect.bind(this,"Web3Auth RpcProvider"));const o=new A;o.push(_t()),o.push(Nt()),o.push(At({origin:location.origin})),o.push(s.middleware),this.rpcEngine=o,this.jsonRpcConnectionEvents=s.events}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw j.invalidRequest({message:_.errors.invalidRequestArgs(),data:h(h({},e||{}),{},{cause:_.errors.invalidRequestArgs()})});const{method:i,params:n}=e;if(typeof i!="string"||i.length===0)throw j.invalidRequest({message:_.errors.invalidRequestMethod(),data:h(h({},e||{}),{},{cause:_.errors.invalidRequestArgs()})});if(n!==void 0&&!Array.isArray(n)&&(typeof n!="object"||n===null))throw j.invalidRequest({message:_.errors.invalidRequestParams(),data:h(h({},e||{}),{},{cause:_.errors.invalidRequestArgs()})});return new Promise((r,s)=>{this.rpcRequest({method:i,params:n},ee(r,s))})}send(e,i){this.rpcRequest(e,i)}sendAsync(e){return new Promise((i,n)=>{this.rpcRequest(e,ee(i,n))})}handleStreamDisconnect(e,i){Rt(e,i,this),this.handleDisconnect(!1,i?i.message:void 0)}}class Lt extends z{constructor({url:e,target:i,features:n,timeout:r=3e4}){super(),a(this,"url",void 0),a(this,"target",void 0),a(this,"features",void 0),a(this,"window",void 0),a(this,"windowTimer",void 0),a(this,"iClosedWindow",void 0),a(this,"timeout",void 0),this.url=e,this.target=i||"_blank",this.features=n||te(St),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=r,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var e;this.window=window.open(this.url.href,this.target,this.features),(e=this.window)!==null&&e!==void 0&&e.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}class V extends Me{constructor(e,{maxEventListeners:i=100,jsonRpcStreamName:n="provider"},r){super(e,{maxEventListeners:i,jsonRpcStreamName:n}),a(this,"tryWindowHandle",void 0),a(this,"windowRefs",void 0),a(this,"iframeUrl",void 0),a(this,"iframeId",void 0),this.state=h(h({},V.defaultState),r),this.iframeUrl="",this.iframeId="",this.windowRefs=new Map,this.on("connect",()=>{this.state.isConnected=!0});const s=o=>{const{method:c,params:d}=o;if(c===T.IFRAME_STATUS){const{isFullScreen:l,rid:f}=d;this.displayIframe({isFull:l,rid:f},!0)}else if(c===T.CLOSE_WINDOW)this.handleCloseWindow(d);else if(c===T.USER_LOGGED_IN){const{currentAuthConnection:l}=d;this.state.isLoggedIn=!0,this.state.currentAuthConnection=l}else if(c===T.USER_LOGGED_OUT)this.state.isLoggedIn=!1,this.state.currentAuthConnection=null,this.displayIframe({isFull:!1},!0);else if(c===T.TOGGLE_WIDGET_BUTTON){const{show:l}=d;this.state.widgetVisibility=l,this.displayIframe()}else if(c===T.ALLOW_WALLET_SERVICE){const{allow:l}=d;this.state.allowWalletService=l}};this.jsonRpcConnectionEvents.on("notification",s)}get isLoggedIn(){return this.state.isLoggedIn}get isIFrameFullScreen(){return this.state.isIFrameFullScreen}get allowWalletService(){return this.state.allowWalletService}isConnected(){return this.state.isConnected}async initializeState(e){try{const{torusUrl:i,torusIframeId:n}=e;this.iframeUrl=i,this.iframeId=n;const{currentAuthConnection:r,isLoggedIn:s}=await this.request({method:E.GET_PROVIDER_STATE,params:[]});s&&this.handleConnect(r,s)}catch(i){u.error("Web3Auth: Failed to get initial state. Please report this bug.",i)}finally{u.info("initialized communication state"),this.state.initialized=!0}}displayIframe({isFull:e=!1,rid:i=""}={},n=!1){const r={};if(e)r.display="block",r.width="100%",r.height="100%",r.top="0px",r.right="0px",r.left="0px",r.bottom="0px";else switch(r.display=this.state.widgetVisibility?"block":"none",r.height=this.state.widgetVisibility?"70px":"0px",r.width=this.state.widgetVisibility?"70px":"0px",this.state.buttonPosition){case P.TOP_LEFT:r.top="0px",r.left="0px",r.right="auto",r.bottom="auto";break;case P.TOP_RIGHT:r.top="0px",r.right="0px",r.left="auto",r.bottom="auto";break;case P.BOTTOM_RIGHT:r.bottom="0px",r.right="0px",r.top="auto",r.left="auto";break;case P.BOTTOM_LEFT:default:r.bottom="0px",r.left="0px",r.top="auto",r.right="auto";break}const s=document.getElementById(this.iframeId);Object.assign(s.style,r),this.state.isIFrameFullScreen=e,n||this.request({method:E.IFRAME_STATUS,params:{isIFrameFullScreen:e,rid:i}})}async handleWindow(e,{url:i,target:n,features:r,timeout:s}={}){const o=new URL(i||`${this.iframeUrl}/redirect?windowId=${e}&sessionNamespace=${window.location.hostname}`),c=new Lt({url:o,target:n,features:r,timeout:s});if(c.open(),!c.window){this.displayIframe({isFull:!0}),this.request({method:E.WINDOW_BLOCKED,params:{windowId:e,finalUrl:o.href}});return}this.windowRefs.set(e,c),c.once("close",()=>{this.windowRefs.delete(e),this.request({method:E.CLOSED_WINDOW,params:{windowId:e}})})}rpcRequest(e,i){const n=i,r=e;Array.isArray(r)||r.jsonrpc||(r.jsonrpc="2.0"),this.rpcEngine.handle(r,n)}handleConnect(e,i){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{currentAuthConnection:e,isLoggedIn:i}),u.debug(_.info.connected(e)))}handleDisconnect(e,i){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new k(1013,i||_.errors.disconnected()),u.debug(n)):(n=new k(1011,i||_.errors.permanentlyDisconnected()),u.error(n),this.state.currentAuthConnection=null,this.state.isLoggedIn=!1,this.state.widgetVisibility=!1,this.state.isIFrameFullScreen=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleCloseWindow(e){const{windowId:i}=e;this.windowRefs.has(i)&&(this.windowRefs.get(i).close(),this.windowRefs.delete(i))}}a(V,"defaultState",{buttonPosition:"bottom-left",currentAuthConnection:null,isIFrameFullScreen:!1,widgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1,hasEmittedConnection:!1,allowWalletService:!1});const Wt=t=>{const e=window.document.createElement("template"),i=t.trim();return e.innerHTML=i,e.content.firstChild};var Dt=function t(e,i){if(e===i)return!0;if(e&&i&&typeof e=="object"&&typeof i=="object"){if(e.constructor!==i.constructor)return!1;var n,r,s;if(Array.isArray(e)){if(n=e.length,n!=i.length)return!1;for(r=n;r--!==0;)if(!t(e[r],i[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(i).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(i,s[r]))return!1;for(r=n;r--!==0;){var o=s[r];if(!t(e[o],i[o]))return!1}return!0}return e!==e&&i!==i};const Ut=$(Dt);class B extends Me{constructor(e,{maxEventListeners:i=100,jsonRpcStreamName:n="provider"}){super(e,{maxEventListeners:i,jsonRpcStreamName:n}),a(this,"chainId",void 0),a(this,"selectedAddress",void 0),a(this,"tryWindowHandle",void 0),this.state=h({},B.defaultState),this.selectedAddress=null,this.chainId=null,this.handleAccountsChanged=this.handleAccountsChanged.bind(this),this.handleChainChanged=this.handleChainChanged.bind(this),this.handleUnlockStateChanged=this.handleUnlockStateChanged.bind(this),this.on("connect",()=>{this.state.isConnected=!0});const r=s=>{const{method:o,params:c}=s;o===Y.ACCOUNTS_CHANGED?this.handleAccountsChanged(c):o===Y.UNLOCK_STATE_CHANGED?this.handleUnlockStateChanged(c):o===Y.CHAIN_CHANGED?this.handleChainChanged(c):Pt.includes(o)&&(this.emit("data",s),this.emit("notification",c.result),this.emit("message",{type:o,data:c}))};this.jsonRpcConnectionEvents.on("notification",r)}isConnected(){return this.state.isConnected}async initializeState(){try{const{accounts:e,chainId:i,isUnlocked:n}=await this.request({method:De.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:i}),this.handleChainChanged({chainId:i}),this.handleUnlockStateChanged({accounts:e,isUnlocked:n}),this.handleAccountsChanged(e)}catch(e){u.error("WsEmbed: Failed to get initial state. Please report this bug.",e)}finally{u.info("initialized provider state"),this.state.initialized=!0}}rpcRequest(e,i,n=!1){let r=i;const s=e;if(!Array.isArray(s)){if(s.jsonrpc||(s.jsonrpc="2.0"),[b.GET_ACCOUNTS,b.ETH_REQUEST_ACCOUNTS,O.SOLANA_REQUEST_ACCOUNTS,O.GET_ACCOUNTS].includes(s.method))r=(o,c)=>{this.handleAccountsChanged(c.result||[],s.method==="eth_accounts",n),i(o,c)};else if(s.method==="wallet_getProviderState"){this.rpcEngine.handle(e,r);return}}this.tryWindowHandle(s,r)}handleConnect(e){this.state.isConnected||(this.state.isConnected=!0,this.emit("connect",{chainId:e}),u.debug(_.info.connected(e)))}handleDisconnect(e,i){if(this.state.isConnected||!this.state.isPermanentlyDisconnected&&!e){this.state.isConnected=!1;let n;e?(n=new k(1013,i||_.errors.disconnected()),u.debug(n)):(n=new k(1011,i||_.errors.permanentlyDisconnected()),u.error(n),this.chainId=null,this.state.accounts=null,this.selectedAddress=null,this.state.isUnlocked=!1,this.state.isPermanentlyDisconnected=!0),this.emit("disconnect",n)}}handleAccountsChanged(e,i=!1,n=!1){let r=e;Array.isArray(r)||(u.error("WsEmbed: Received non-array accounts parameter. Please report this bug.",r),r=[]);for(const s of e)if(typeof s!="string"){u.error("WsEmbed: Received non-string account. Please report this bug.",e),r=[];break}Ut(this.state.accounts,r)||(i&&Array.isArray(this.state.accounts)&&this.state.accounts.length>0&&!n&&u.error('WsEmbed: "eth_accounts" unexpectedly updated accounts. Please report this bug.',r),this.state.accounts=r,this.emit("accountsChanged",r)),this.selectedAddress!==r[0]&&(this.selectedAddress=r[0]||null)}handleChainChanged({chainId:e}={}){if(!e){u.error("WsEmbed: Received invalid network parameters. Please report this bug.",{chainId:e});return}e==="loading"?this.handleDisconnect(!0):(this.handleConnect(e),e!==this.chainId&&(this.chainId=e,this.state.initialized&&this.emit("chainChanged",this.chainId)))}handleUnlockStateChanged({accounts:e,isUnlocked:i}={}){if(typeof i!="boolean"){u.error("WsEmbed: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:i});return}i!==this.state.isUnlocked&&(this.state.isUnlocked=i,this.handleAccountsChanged(e||[]))}}a(B,"defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});function Ee(t){return new Promise((e,i)=>{try{const n=document.createElement("img");n.onload=()=>e(!0),n.onerror=()=>e(!1),n.src=t}catch(n){i(n)}})}const Mt=t=>{const{document:e}=t,i=e.querySelector('head > meta[property="og:site_name"]');if(i)return i.content;const n=e.querySelector('head > meta[name="title"]');return n?n.content:e.title&&e.title.length>0?e.title:t.location.hostname};async function xt(t){try{const{document:e}=t;let i=e.querySelector('head > link[rel="shortcut icon"]');return i&&await Ee(i.href)||(i=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(n=>!!n.href),i&&await Ee(i.href))?i.href:""}catch{return""}}const jt=async()=>({name:Mt(window),icon:await xt(window)}),Ft="5.0.11",Se=`v${Ft.split(".")[0]}`,ie={[L.TESTING]:{url:"https://develop-wallet.web3auth.io",logLevel:"debug"},[L.DEVELOPMENT]:{url:"http://localhost:4050",logLevel:"debug"},[L.STAGING]:{url:`https://staging-wallet.web3auth.io/${Se}`,logLevel:"debug"},[L.PRODUCTION]:{url:`https://wallet.web3auth.io/${Se}`,logLevel:"error"}};(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{url:i}=ie.production;e.href=`${i}/frame`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){u.warn(e)}})();const Ht=new Set([O.SEND_TRANSACTION,O.SIGN_MESSAGE,O.SIGN_TRANSACTION,O.SIGN_ALL_TRANSACTIONS,b.ETH_SIGN,b.ETH_SIGN_TYPED_DATA_V4,b.PERSONAL_SIGN,b.ETH_TRANSACTION,b.ADD_CHAIN,b.SWITCH_CHAIN,De.WALLET_SWITCH_CHAIN]);class zt{constructor({modalZIndex:e=99999,web3AuthClientId:i,web3AuthNetwork:n}){a(this,"isInitialized",void 0),a(this,"modalZIndex",void 0),a(this,"provider",void 0),a(this,"communicationProvider",void 0),a(this,"buttonPosition",void 0),a(this,"web3AuthClientId",void 0),a(this,"web3AuthNetwork",void 0),a(this,"isPluginMode",void 0),a(this,"confirmationStrategy",void 0),a(this,"buildEnv",void 0),a(this,"embedNonce",Q()),this.isInitialized=!1,this.modalZIndex=e,this.web3AuthClientId=i,this.web3AuthNetwork=n}get isLoggedIn(){var e;return((e=this.communicationProvider)===null||e===void 0?void 0:e.isLoggedIn)||!1}get getBuildEnv(){return this.buildEnv}async init({buildEnv:e=L.PRODUCTION,enableLogging:i=!1,chains:n,chainId:r,walletUrls:s,whiteLabel:o,confirmationStrategy:c=C.DEFAULT,accountAbstractionConfig:d,enableKeyExport:l=!1}){if(this.isInitialized)throw new Error("Already initialized");this.buildEnv=e,this.confirmationStrategy=c;const{url:f,logLevel:m}=s&&s[e]?h(h({},ie[e]),s[e]):ie[e];u.info(f,"url loaded"),u.setDefaultLevel(m),i?u.enableAll():u.disableAll();const p=new URL(f);p.pathname.endsWith("/")?p.pathname+="frame":p.pathname+="/frame";const w=new URLSearchParams;w.append("origin",window.location.origin),w.append("nonce",this.embedNonce),p.hash=w.toString();const g=this.getTheme((o==null?void 0:o.mode)||J.light),S=Wt(`<iframe
        id="walletIframe-${this.embedNonce}"
        class="walletIframe-${this.embedNonce}"
        sandbox="allow-popups allow-scripts allow-same-origin allow-forms allow-modals allow-downloads"
        src="${p.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()};
        color-scheme: ${g}"
        allow="clipboard-write"
      ></iframe>`);this.buttonPosition=(o==null?void 0:o.buttonPosition)||P.BOTTOM_LEFT;const I=await jt();return new Promise((N,xe)=>{try{window.document.body.appendChild(S);const D=async oe=>{if(oe.origin!==p.origin)return;const{message:je,nonce:Fe}=oe.data||{};je===It&&Fe===this.embedNonce&&(window.removeEventListener("message",D),S.contentWindow.postMessage({chains:n,chainId:r,dappMetadata:I,enableLogging:i,web3AuthClientId:this.web3AuthClientId,web3AuthNetwork:this.web3AuthNetwork,whiteLabel:o,confirmationStrategy:c,accountAbstractionConfig:d,enableKeyExport:l},p.origin),await this.setupWeb3({torusUrl:f,walletIframe:S}),this.isInitialized=!0,N())};window.addEventListener("message",D)}catch(D){xe(D)}})}async login(e={}){if(!this.isInitialized)throw new Error("Call init() first");const i=this.communicationProvider.isIFrameFullScreen;try{!e.authConnection&&!i&&this.communicationProvider.displayIframe({isFull:!0});const n=await new Promise((r,s)=>{const c=Object.values(ke).includes(this.provider.chainId)?O.SOLANA_REQUEST_ACCOUNTS:b.ETH_REQUEST_ACCOUNTS;this.provider.rpcRequest({method:c,params:[e.authConnection,e.login_hint]},ee(r,s))});if(u.info("check: res",n),Array.isArray(n)&&n.length>0)return this.confirmationStrategy===C.AUTO_APPROVE&&u.warn("Confirmation strategy auto approve is not allowed on Embed Mode, using Default instead."),n;throw new Error("Login failed")}catch(n){throw u.error("login failed",n),n}finally{i||this.communicationProvider.displayIframe({isFull:!1})}}async loginWithSessionId(e){if(!this.isInitialized)throw new Error("Call init() first");if(!e.sessionId)throw new Error("sessionId is required");try{const i=await this.communicationProvider.request({method:E.LOGIN_WITH_SESSION_ID,params:[e.sessionId,e.sessionNamespace||""]});if(u.info("check: res",i),i.success)return this.isPluginMode=!0,this.confirmationStrategy===C.POPUP&&u.warn("Confirmation strategy popup is not allowed on Plugin Mode, using Default instead."),i.success;throw new Error("Login failed")}catch(i){throw u.error("login with session id failed",i),i}}async logout(){if(!this.communicationProvider.isLoggedIn)throw new Error("Not logged in");await this.communicationProvider.request({method:E.LOGOUT,params:[]})}async cleanUp(){var e;(e=this.communicationProvider)!==null&&e!==void 0&&e.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(n){return n instanceof Element||n instanceof Document}const i=window.document.getElementById(`walletIframe-${this.embedNonce}`);e(i)&&i.remove(),this.isInitialized=!1}async getUserInfo(){return await this.communicationProvider.request({method:E.USER_INFO,params:[]})}async showWalletConnectScanner(e){const i=e?e.show:!0;this.communicationProvider.displayIframe({isFull:i});try{await this.communicationProvider.request({method:E.SHOW_WALLET_CONNECT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showWalletUi(e){const i=e?e.show:!0;this.communicationProvider.displayIframe({isFull:i});try{await this.communicationProvider.request({method:E.SHOW_WALLET_UI,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showCheckout(e){const i=e?e.show:!0;this.communicationProvider.displayIframe({isFull:i});try{await this.communicationProvider.request({method:E.SHOW_CHECKOUT,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}async showSwap(e){const i=e?e.show:!0;this.communicationProvider.displayIframe({isFull:i});try{await this.communicationProvider.request({method:E.SHOW_SWAP,params:e})}catch{this.communicationProvider.displayIframe({isFull:!1})}}getConfirmationStrategyFinal(e){let i=this.confirmationStrategy;return!Array.isArray(e)&&Ht.has(e.method)&&this.confirmationStrategy!==C.MODAL&&!this.isPluginMode&&(i=C.POPUP),i}getTheme(e){return e===J.light?"light":e===J.dark||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}async setupWeb3(e){u.info("setupWeb3 running");const i=new he({name:"embed_torus",target:"iframe_torus",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),n=new he({name:"embed_communication",target:"iframe_communication",targetWindow:e.walletIframe.contentWindow,targetOrigin:new URL(e.torusUrl).origin}),r=new B(i,{}),s=new V(n,{},{buttonPosition:this.buttonPosition});r.tryWindowHandle=(l,f)=>{const m=l,p=this.getConfirmationStrategyFinal(l),{allowWalletService:w}=s;if(p===C.POPUP&&w){const g=Q();s.handleWindow(g,{target:"_blank",features:te(bt),timeout:500}),m.windowId=g}r.rpcEngine.handle(m,f)},s.tryWindowHandle=(l,f)=>{const m=l,p=this.getConfirmationStrategyFinal(l),{allowWalletService:w}=s;if(p===C.POPUP&&w){const g=Q();s.handleWindow(g,{target:"_blank",features:te(Et),timeout:500}),m.params.windowId=g}s.rpcEngine.handle(m,f)};const o=l=>{const f=r[l],m=this;r[l]=function(w,g){const{method:S,params:I=[]}=w;if(S===b.ETH_REQUEST_ACCOUNTS||S===O.SOLANA_REQUEST_ACCOUNTS){if(!g)return m.login({authConnection:I[0]});m.login({authConnection:I[0]}).then(N=>g(null,N)).catch(N=>g(N))}return f.apply(this,[w,g])}};o("request"),o("sendAsync"),o("send");const c=new Proxy(r,{deleteProperty:()=>!0}),d=new Proxy(s,{deleteProperty:()=>!0});this.provider=c,this.communicationProvider=d,u.info("test setupWeb3 "),await Promise.all([r.initializeState(),s.initializeState(h(h({},e),{},{torusIframeId:e.walletIframe.id}))]),u.debug("WsEmbed - injected provider")}}export{P as BUTTON_POSITION,C as CONFIRMATION_STRATEGY,b as EVM_METHOD_TYPES,ke as SOLANA_CHAIN_IDS,O as SOLANA_METHOD_TYPES,B as TorusInPageProvider,L as WS_EMBED_BUILD_ENV,zt as default};
